# 36b_type_arbiter_aggressive_2d

目标：比较5组（无LLM/规则仲裁/LLM三种集成方式）对 LA/TA/Explain/Eff/Final 的影响。

说明：评测中 GT 的 `A->B` 会被拆成 `[A,B]`，命中任一端即算 component_correct；但仍要求 **完全相等**（例如 `frontend-0` 不等于 `frontend`）。

## 试验设置
- **phase1**: metadata=../metadata_phase1.csv; gt=../AIOpsChallengeJudge/ground_truth_phase1.jsonl; dates=2025-06-07
- **phase2**: metadata=../metadata_phase2.csv; gt=../AIOpsChallengeJudge/ground_truth_phase2.jsonl; dates=2025-06-17
- suite slug: `type_arbiter_aggressive_2d`（对应 outputs/experiments/type_arbiter_aggressive_2d/）

## 候选方案
- 组1：不调用LLM + 不改算法（aggressive dominance）（key=g1_no_llm_no_change）
- 组2：不调用LLM + 规则仲裁（postcheck，aggressive dominance）（key=g2_no_llm_rule_arbiter）
- 组3：LLM类型仲裁（postcheck，aggressive dominance）（key=g3_llm_postcheck）
- 组4：LLM类型仲裁（pregate，aggressive dominance）（key=g4_llm_pregate）
- 组5：LLM类型仲裁（hardfilter，aggressive dominance）（key=g5_llm_hardfilter）

## 结果汇总（全部 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（aggressive dominance） | 48 | 12.50% | 41.67% | 31.46% | 81.87% | 33.00 |
| 组2：不调用LLM + 规则仲裁（postcheck，aggressive dominance） | 48 | 12.50% | 41.67% | 35.96% | 81.87% | 33.45 |
| 组3：LLM类型仲裁（postcheck，aggressive dominance） | 48 | 14.58% | 83.33% | 39.33% | 81.87% | 51.29 |
| 组4：LLM类型仲裁（pregate，aggressive dominance） | 48 | 14.58% | 83.33% | 38.20% | 81.87% | 51.17 |
| 组5：LLM类型仲裁（hardfilter，aggressive dominance） | 48 | 14.58% | 81.25% | 33.71% | 81.87% | 49.89 |

## phase1 结果汇总（该 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（aggressive dominance） | 24 | 20.83% | 50.00% | 36.96% | 81.87% | 40.22 |
| 组2：不调用LLM + 规则仲裁（postcheck，aggressive dominance） | 24 | 20.83% | 50.00% | 41.30% | 81.87% | 40.65 |
| 组3：LLM类型仲裁（postcheck，aggressive dominance） | 24 | 25.00% | 87.50% | 45.65% | 81.87% | 57.75 |
| 组4：LLM类型仲裁（pregate，aggressive dominance） | 24 | 25.00% | 87.50% | 45.65% | 81.87% | 57.75 |
| 组5：LLM类型仲裁（hardfilter，aggressive dominance） | 24 | 25.00% | 87.50% | 28.26% | 81.87% | 56.01 |

## phase2 结果汇总（该 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（aggressive dominance） | 24 | 4.17% | 33.33% | 25.58% | 81.87% | 25.75 |
| 组2：不调用LLM + 规则仲裁（postcheck，aggressive dominance） | 24 | 4.17% | 33.33% | 30.23% | 81.87% | 26.21 |
| 组3：LLM类型仲裁（postcheck，aggressive dominance） | 24 | 4.17% | 79.17% | 32.56% | 81.87% | 44.78 |
| 组4：LLM类型仲裁（pregate，aggressive dominance） | 24 | 4.17% | 79.17% | 30.23% | 81.87% | 44.54 |
| 组5：LLM类型仲裁（hardfilter，aggressive dominance） | 24 | 4.17% | 75.00% | 39.53% | 81.87% | 43.81 |

## LA 丢分点分析（组件命中）

为避免报告过长，本节仅对 **Final 最优** 的方案（组3：LLM类型仲裁（postcheck，aggressive dominance），key=g3_llm_postcheck）做错因分解。

- 样本数 N=48，原始 LA=14.58%（命中 7/48）
- 命名后缀归一化（仅用于解释，不改变 judge 规则）可带来的理论上限：约 20.83%
- 纯后缀错配计数：GT 为 `*-0` 但预测 base（可选 pod 才能修复）=0；预测为 `*-0` 但 GT 为 base（可通过 strip 修复）=0

| 类别 | 计数 | 解释 |
|---|---:|---|
| HIT | 7 | 预测 component 与 GT parts 任一端完全相等 |
| GT_NODE__PRED_SERVICE | 14 | GT 是 node/TiDB，预测成服务 |
| GT_SERVICE__PRED_NODE | 4 | GT 是服务，预测成 node/TiDB |
| SAME_KIND_BUT_WRONG | 23 | 同类型但选错对象（服务/节点内互相混淆） |

Top 混淆对（GT -> Pred，按出现次数）
| 次数 | GT | Pred |
|---:|---|---|
| 1 | aiops-k8s-01 | cartservice |
| 1 | recommendationservice | frontend-0 |
| 1 | cartservice->redis-cart | frontend-0 |
| 1 | aiops-k8s-08 | shippingservice |
| 1 | frontend->productcatalogservice | frontend-2 |
| 1 | checkoutservice->paymentservice | aiops-k8s-04 |
| 1 | frontend->cartservice | frontend-2 |
| 1 | frontend->recommendationservice | emailservice |
| 1 | aiops-k8s-04 | emailservice |
| 1 | emailservice | frontend |

## 分 phase 分日期明细

| phase | date | N | 方案key | LA | TA | Explain | Eff | Final |
|---|---|---:|---|---:|---:|---:|---:|---:|
| phase1 | 2025-06-07 | 24 | g1_no_llm_no_change | 20.83% | 50.00% | 36.96% | 81.87% | 40.22 |
| phase1 | 2025-06-07 | 24 | g2_no_llm_rule_arbiter | 20.83% | 50.00% | 41.30% | 81.87% | 40.65 |
| phase1 | 2025-06-07 | 24 | g3_llm_postcheck | 25.00% | 87.50% | 45.65% | 81.87% | 57.75 |
| phase1 | 2025-06-07 | 24 | g4_llm_pregate | 25.00% | 87.50% | 45.65% | 81.87% | 57.75 |
| phase1 | 2025-06-07 | 24 | g5_llm_hardfilter | 25.00% | 87.50% | 28.26% | 81.87% | 56.01 |
| phase2 | 2025-06-17 | 24 | g1_no_llm_no_change | 4.17% | 33.33% | 25.58% | 81.87% | 25.75 |
| phase2 | 2025-06-17 | 24 | g2_no_llm_rule_arbiter | 4.17% | 33.33% | 30.23% | 81.87% | 26.21 |
| phase2 | 2025-06-17 | 24 | g3_llm_postcheck | 4.17% | 79.17% | 32.56% | 81.87% | 44.78 |
| phase2 | 2025-06-17 | 24 | g4_llm_pregate | 4.17% | 79.17% | 30.23% | 81.87% | 44.54 |
| phase2 | 2025-06-17 | 24 | g5_llm_hardfilter | 4.17% | 75.00% | 39.53% | 81.87% | 43.81 |
