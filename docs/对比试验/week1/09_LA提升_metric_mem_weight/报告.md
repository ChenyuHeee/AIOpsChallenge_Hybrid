# LA提升_metric_mem_weight

目标：在固定数据口径下，比较多种方案对 Final（以及 LA/TA/Explainability/Efficiency）的影响。

## 试验设置
- metadata: `../metadata_phase1.csv`
- ground truth: `../AIOpsChallengeJudge/ground_truth_phase1.jsonl`
- telemetry root: `../data`
- dates（按天全量）: 2025-06-07, 2025-06-08
- suite slug: `la_boost_v4_metric_mem_weight`（对应 outputs/experiments/la_boost_v4_metric_mem_weight/）

## 候选方案
- 方案A：基线（禁用 legacy 记忆，作为新对照）（key=base_safe）
  - env: `{"RCA_COMPONENT_SOURCE": "consensus", "RCA_WINDOW_PADDING_MIN": "20", "RCA_ENABLE_MODALITY_BONUS": "0", "RCA_ENABLE_HINT_BONUS": "0", "RCA_COMPONENT_PRIOR_SCALE": "1.0", "RCA_STRIP_REPLICA_SUFFIX": "1", "RCA_USE_LEGACY_MEMORY": "0"}`
- 方案B：hints 注入候选（seed=0.15）（key=hint_seed）
  - env: `{"RCA_COMPONENT_SOURCE": "consensus", "RCA_WINDOW_PADDING_MIN": "20", "RCA_ENABLE_MODALITY_BONUS": "0", "RCA_ENABLE_HINT_BONUS": "0", "RCA_COMPONENT_PRIOR_SCALE": "1.0", "RCA_STRIP_REPLICA_SUFFIX": "1", "RCA_USE_LEGACY_MEMORY": "0", "RCA_ENABLE_HINT_SEED": "1", "RCA_HINT_SEED_SCORE": "0.15"}`
- 方案C：hints 注入 + 回退优先 hints（key=hint_seed_fb）
  - env: `{"RCA_COMPONENT_SOURCE": "consensus", "RCA_WINDOW_PADDING_MIN": "20", "RCA_ENABLE_MODALITY_BONUS": "0", "RCA_ENABLE_HINT_BONUS": "0", "RCA_COMPONENT_PRIOR_SCALE": "1.0", "RCA_STRIP_REPLICA_SUFFIX": "1", "RCA_USE_LEGACY_MEMORY": "0", "RCA_ENABLE_HINT_SEED": "1", "RCA_HINT_SEED_SCORE": "0.15", "RCA_FALLBACK_PREFER_HINTS": "1"}`
- 方案D：hints 注入+回退优先 hints + 轻先验衰减（scale=0.7）（key=hint_seed_fb_p07）
  - env: `{"RCA_COMPONENT_SOURCE": "consensus", "RCA_WINDOW_PADDING_MIN": "20", "RCA_ENABLE_MODALITY_BONUS": "0", "RCA_ENABLE_HINT_BONUS": "0", "RCA_COMPONENT_PRIOR_SCALE": "0.7", "RCA_STRIP_REPLICA_SUFFIX": "1", "RCA_USE_LEGACY_MEMORY": "0", "RCA_ENABLE_HINT_SEED": "1", "RCA_HINT_SEED_SCORE": "0.15", "RCA_FALLBACK_PREFER_HINTS": "1"}`

## 结果汇总（按日期评测；并给出跨日期平均）

| 方案 | 平均LA | 平均TA | 平均Explain | 平均Eff | 平均Final |
|---|---:|---:|---:|---:|---:|
| 方案A：基线（禁用 legacy 记忆，作为新对照） | 12.50% | 87.50% | 14.25% | 81.87% | 49.61 |
| 方案B：hints 注入候选（seed=0.15） | 12.50% | 93.75% | 15.78% | 81.87% | 52.27 |
| 方案C：hints 注入 + 回退优先 hints | 12.50% | 89.58% | 15.78% | 81.87% | 50.60 |
| 方案D：hints 注入+回退优先 hints + 轻先验衰减（scale=0.7） | 12.50% | 95.83% | 12.08% | 81.87% | 52.73 |

## 分日期明细

| date | N | 方案key | LA | TA | Explain | Eff | Final |
|---|---:|---|---:|---:|---:|---:|---:|
| 2025-06-07 | 24.0 | base_safe | 20.83% | 91.67% | 17.39% | 81.87% | 54.93 |
| 2025-06-07 | 24.0 | hint_seed | 20.83% | 95.83% | 13.04% | 81.87% | 56.16 |
| 2025-06-07 | 24.0 | hint_seed_fb | 20.83% | 91.67% | 13.04% | 81.87% | 54.49 |
| 2025-06-07 | 24.0 | hint_seed_fb_p07 | 20.83% | 100.00% | 13.04% | 81.87% | 57.82 |
| 2025-06-08 | 24.0 | base_safe | 4.17% | 83.33% | 11.11% | 81.87% | 44.30 |
| 2025-06-08 | 24.0 | hint_seed | 4.17% | 91.67% | 18.52% | 81.87% | 48.37 |
| 2025-06-08 | 24.0 | hint_seed_fb | 4.17% | 87.50% | 18.52% | 81.87% | 46.71 |
| 2025-06-08 | 24.0 | hint_seed_fb_p07 | 4.17% | 91.67% | 11.11% | 81.87% | 47.63 |

## 预测 component 分布（Top-5）

说明：该表用于快速观察是否出现 ‘adservice 坍缩’（例如 Top-1 占比异常高）。

| date | 方案key | Top-5 components（component:count） |
|---|---|---|
| 2025-06-07 | base_safe | checkoutservice:13; aiops-k8s-07:3; adservice:2; cartservice:2; aiops-k8s-03:1 |
| 2025-06-07 | hint_seed | checkoutservice:13; aiops-k8s-07:3; adservice:2; cartservice:2; aiops-k8s-03:1 |
| 2025-06-07 | hint_seed_fb | checkoutservice:13; aiops-k8s-07:3; adservice:2; cartservice:2; aiops-k8s-03:1 |
| 2025-06-07 | hint_seed_fb_p07 | checkoutservice:12; aiops-k8s-07:4; cartservice:2; adservice:1; aiops-k8s-03:1 |
| 2025-06-08 | base_safe | checkoutservice:17; aiops-k8s-07:4; adservice:2; aiops-k8s-08:1 |
| 2025-06-08 | hint_seed | checkoutservice:17; aiops-k8s-07:4; adservice:2; aiops-k8s-08:1 |
| 2025-06-08 | hint_seed_fb | checkoutservice:17; aiops-k8s-07:4; adservice:2; aiops-k8s-08:1 |
| 2025-06-08 | hint_seed_fb_p07 | checkoutservice:13; aiops-k8s-07:4; aiops-k8s-04:2; aiops-k8s-08:2; adservice:1 |

## 产物路径
- submissions: `outputs/experiments/la_boost_v4_metric_mem_weight/`
- filtered gt: `tmp/filtered/` (gt_YYYY-MM-DD_*.jsonl)
