# 36_type_arbiter_5groups_p1p2_7d

目标：比较5组（无LLM/规则仲裁/LLM三种集成方式）对 LA/TA/Explain/Eff/Final 的影响。

说明：评测中 GT 的 `A->B` 会被拆成 `[A,B]`，命中任一端即算 component_correct；但仍要求 **完全相等**（例如 `frontend-0` 不等于 `frontend`）。

## 试验设置
- **phase1**: dates=2025-06-13, 2025-06-07, 2025-06-11, 2025-06-08, 2025-06-10, 2025-06-09, 2025-06-14
- **phase2**: dates=2025-06-27, 2025-06-17, 2025-06-20, 2025-06-18, 2025-06-19, 2025-06-24, 2025-06-28
- suite slug: `type_arbiter_5groups_p1p2_7d`（对应 outputs/experiments/type_arbiter_5groups_p1p2_7d/）

## 候选方案
- 组1：不调用LLM + 不改算法（当前v9基线）（key=g1_no_llm_no_change）
- 组2：不调用LLM + 规则仲裁减轻混淆（postcheck）（key=g2_no_llm_rule_arbiter）
- 组3：LLM类型仲裁（postcheck）（key=g3_llm_postcheck）
- 组4：LLM类型仲裁（pregate软门控重排）（key=g4_llm_pregate）
- 组5：LLM类型仲裁（hardfilter硬过滤）（key=g5_llm_hardfilter）

## 结果汇总（全部 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（当前v9基线） | 311 | 6.75% | 47.91% | 27.17% | 81.87% | 32.77 |
| 组2：不调用LLM + 规则仲裁减轻混淆（postcheck） | 311 | 6.75% | 45.66% | 34.01% | 81.87% | 32.55 |
| 组3：LLM类型仲裁（postcheck） | 311 | 7.40% | 75.56% | 34.94% | 81.87% | 44.86 |
| 组4：LLM类型仲裁（pregate软门控重排） | 311 | 7.40% | 74.92% | 36.41% | 81.87% | 44.75 |
| 组5：LLM类型仲裁（hardfilter硬过滤） | 311 | 6.75% | 74.60% | 34.94% | 81.87% | 44.22 |

## phase1 结果汇总（该 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（当前v9基线） | 159 | 10.06% | 47.80% | 21.46% | 81.87% | 33.48 |
| 组2：不调用LLM + 规则仲裁减轻混淆（postcheck） | 159 | 10.06% | 44.65% | 27.94% | 81.87% | 32.87 |
| 组3：LLM类型仲裁（postcheck） | 159 | 10.69% | 75.47% | 27.94% | 81.87% | 45.45 |
| 组4：LLM类型仲裁（pregate软门控重排） | 159 | 10.69% | 74.84% | 29.96% | 81.87% | 45.40 |
| 组5：LLM类型仲裁（hardfilter硬过滤） | 159 | 10.06% | 74.84% | 30.36% | 81.87% | 45.19 |

## phase2 结果汇总（该 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（当前v9基线） | 152 | 3.29% | 48.03% | 31.97% | 81.87% | 31.91 |
| 组2：不调用LLM + 规则仲裁减轻混淆（postcheck） | 152 | 3.29% | 46.71% | 39.12% | 81.87% | 32.10 |
| 组3：LLM类型仲裁（postcheck） | 152 | 3.95% | 75.66% | 40.82% | 81.87% | 44.11 |
| 组4：LLM类型仲裁（pregate软门控重排） | 152 | 3.95% | 75.00% | 41.84% | 81.87% | 43.95 |
| 组5：LLM类型仲裁（hardfilter硬过滤） | 152 | 3.29% | 74.34% | 38.78% | 81.87% | 43.12 |

## LA 丢分点分析（组件命中）

本节解释为什么 LA 看起来“很低”：judge 对 component 的命中要求是 **完全相等**（GT 的 `A->B` 只是在 parts 上做 OR），因此只要“选错对象/选错域/选错类型”，LA 就会直接丢分。

以 Final 最优方案 **组3（g3_llm_postcheck）** 为例（N=311）：
- 原始 LA = 23/311 = **7.40%**
- 若仅做非常保守的命名归一化（去掉末尾 `-0`、去掉末尾 hash 等，仅用于解释，不改变 judge 规则），理论上限约 **11.25%**（说明“后缀差异”不是主要矛盾）
- 纯后缀错配计数：GT 为 `*-0` 但预测 base（需要能输出 pod 才能修复）=3；预测为 `*-0` 但 GT 为 base（strip 可修复）=2

错因分类（失败样本）：
- GT node/TiDB，预测成服务：93
- GT 服务，预测成 node/TiDB：45
- 同类型但选错对象（服务/节点内互相混淆）：150

Top 混淆对（GT -> Pred，按出现次数；组3）：
- tidb-tikv-0 -> cartservice（11）
- tidb-tikv-0 -> adservice（9）
- aiops-k8s-06 -> cartservice（6）
- aiops-k8s-05 -> cartservice（5）
- aiops-k8s-06 -> adservice（4）
- aiops-k8s-08 -> adservice（4）
- adservice -> emailservice（4）
- aiops-k8s-08 -> emailservice（4）
- tidb-pd-0 -> adservice（4）
- aiops-k8s-04 -> emailservice（3）

## 分 phase 分日期明细（每个日期只对该日期 uuids 评分）

| phase | date | N | 方案key | LA | TA | Explain | Eff | Final |
|---|---|---:|---|---:|---:|---:|---:|---:|
| phase1 | 2025-06-13 | 24 | g1_no_llm_no_change | 0.00% | 33.33% | 14.29% | 0.00% | 14.76 |
| phase1 | 2025-06-13 | 24 | g2_no_llm_rule_arbiter | 0.00% | 29.17% | 17.86% | 0.00% | 13.45 |
| phase1 | 2025-06-13 | 24 | g3_llm_postcheck | 0.00% | 62.50% | 25.00% | 0.00% | 27.50 |
| phase1 | 2025-06-13 | 24 | g4_llm_pregate | 0.00% | 58.33% | 32.14% | 0.00% | 26.55 |
| phase1 | 2025-06-13 | 24 | g5_llm_hardfilter | 0.00% | 62.50% | 28.57% | 0.00% | 27.86 |
| phase1 | 2025-06-07 | 24 | g1_no_llm_no_change | 20.83% | 50.00% | 36.96% | 81.87% | 40.22 |
| phase1 | 2025-06-07 | 24 | g2_no_llm_rule_arbiter | 20.83% | 50.00% | 41.30% | 81.87% | 40.65 |
| phase1 | 2025-06-07 | 24 | g3_llm_postcheck | 25.00% | 87.50% | 41.30% | 81.87% | 57.32 |
| phase1 | 2025-06-07 | 24 | g4_llm_pregate | 25.00% | 87.50% | 41.30% | 81.87% | 57.32 |
| phase1 | 2025-06-07 | 24 | g5_llm_hardfilter | 20.83% | 87.50% | 41.30% | 81.87% | 55.65 |
| phase1 | 2025-06-11 | 24 | g1_no_llm_no_change | 16.67% | 58.33% | 21.74% | 81.87% | 40.36 |
| phase1 | 2025-06-11 | 24 | g2_no_llm_rule_arbiter | 20.83% | 58.33% | 28.26% | 81.87% | 42.68 |
| phase1 | 2025-06-11 | 24 | g3_llm_postcheck | 16.67% | 87.50% | 30.43% | 81.87% | 52.90 |
| phase1 | 2025-06-11 | 24 | g4_llm_pregate | 16.67% | 83.33% | 28.26% | 81.87% | 51.01 |
| phase1 | 2025-06-11 | 24 | g5_llm_hardfilter | 16.67% | 87.50% | 30.43% | 81.87% | 52.90 |
| phase1 | 2025-06-08 | 24 | g1_no_llm_no_change | 4.17% | 33.33% | 7.41% | 81.87% | 23.93 |
| phase1 | 2025-06-08 | 24 | g2_no_llm_rule_arbiter | 4.17% | 33.33% | 18.52% | 81.87% | 25.04 |
| phase1 | 2025-06-08 | 24 | g3_llm_postcheck | 4.17% | 83.33% | 7.41% | 81.87% | 43.93 |
| phase1 | 2025-06-08 | 24 | g4_llm_pregate | 4.17% | 83.33% | 18.52% | 81.87% | 45.04 |
| phase1 | 2025-06-08 | 24 | g5_llm_hardfilter | 4.17% | 83.33% | 11.11% | 81.87% | 44.30 |
| phase1 | 2025-06-10 | 24 | g1_no_llm_no_change | 12.50% | 62.50% | 28.57% | 81.87% | 41.04 |
| phase1 | 2025-06-10 | 24 | g2_no_llm_rule_arbiter | 8.33% | 54.17% | 25.71% | 81.87% | 35.76 |
| phase1 | 2025-06-10 | 24 | g3_llm_postcheck | 12.50% | 79.17% | 31.43% | 81.87% | 48.00 |
| phase1 | 2025-06-10 | 24 | g4_llm_pregate | 12.50% | 79.17% | 40.00% | 81.87% | 48.85 |
| phase1 | 2025-06-10 | 24 | g5_llm_hardfilter | 12.50% | 79.17% | 45.71% | 81.87% | 49.43 |
| phase1 | 2025-06-09 | 23 | g1_no_llm_no_change | 13.04% | 39.13% | 8.57% | 81.87% | 29.91 |
| phase1 | 2025-06-09 | 23 | g2_no_llm_rule_arbiter | 13.04% | 34.78% | 20.00% | 81.87% | 29.32 |
| phase1 | 2025-06-09 | 23 | g3_llm_postcheck | 13.04% | 52.17% | 22.86% | 81.87% | 36.56 |
| phase1 | 2025-06-09 | 23 | g4_llm_pregate | 13.04% | 56.52% | 14.29% | 81.87% | 37.44 |
| phase1 | 2025-06-09 | 23 | g5_llm_hardfilter | 13.04% | 52.17% | 20.00% | 81.87% | 36.27 |
| phase1 | 2025-06-14 | 16 | g1_no_llm_no_change | 0.00% | 62.50% | 23.33% | 0.00% | 27.33 |
| phase1 | 2025-06-14 | 16 | g2_no_llm_rule_arbiter | 0.00% | 56.25% | 36.67% | 0.00% | 26.17 |
| phase1 | 2025-06-14 | 16 | g3_llm_postcheck | 0.00% | 75.00% | 26.67% | 0.00% | 32.67 |
| phase1 | 2025-06-14 | 16 | g4_llm_pregate | 0.00% | 75.00% | 30.00% | 0.00% | 33.00 |
| phase1 | 2025-06-14 | 16 | g5_llm_hardfilter | 0.00% | 68.75% | 26.67% | 0.00% | 30.17 |
| phase2 | 2025-06-27 | 24 | g1_no_llm_no_change | 0.00% | 41.67% | 23.91% | 0.00% | 19.06 |
| phase2 | 2025-06-27 | 24 | g2_no_llm_rule_arbiter | 0.00% | 37.50% | 30.43% | 0.00% | 18.04 |
| phase2 | 2025-06-27 | 24 | g3_llm_postcheck | 0.00% | 70.83% | 36.96% | 0.00% | 32.03 |
| phase2 | 2025-06-27 | 24 | g4_llm_pregate | 0.00% | 66.67% | 34.78% | 0.00% | 30.14 |
| phase2 | 2025-06-27 | 24 | g5_llm_hardfilter | 0.00% | 70.83% | 34.78% | 0.00% | 31.81 |
| phase2 | 2025-06-17 | 24 | g1_no_llm_no_change | 4.17% | 33.33% | 25.58% | 81.87% | 25.75 |
| phase2 | 2025-06-17 | 24 | g2_no_llm_rule_arbiter | 4.17% | 33.33% | 30.23% | 81.87% | 26.21 |
| phase2 | 2025-06-17 | 24 | g3_llm_postcheck | 4.17% | 83.33% | 41.86% | 81.87% | 47.37 |
| phase2 | 2025-06-17 | 24 | g4_llm_pregate | 4.17% | 83.33% | 30.23% | 81.87% | 46.21 |
| phase2 | 2025-06-17 | 24 | g5_llm_hardfilter | 4.17% | 79.17% | 34.88% | 81.87% | 45.01 |
| phase2 | 2025-06-20 | 24 | g1_no_llm_no_change | 4.17% | 58.33% | 45.28% | 81.87% | 37.72 |
| phase2 | 2025-06-20 | 24 | g2_no_llm_rule_arbiter | 4.17% | 58.33% | 62.26% | 81.87% | 39.41 |
| phase2 | 2025-06-20 | 24 | g3_llm_postcheck | 4.17% | 79.17% | 56.60% | 81.87% | 47.18 |
| phase2 | 2025-06-20 | 24 | g4_llm_pregate | 4.17% | 75.00% | 58.49% | 81.87% | 45.70 |
| phase2 | 2025-06-20 | 24 | g5_llm_hardfilter | 4.17% | 79.17% | 56.60% | 81.87% | 47.18 |
| phase2 | 2025-06-18 | 24 | g1_no_llm_no_change | 4.17% | 50.00% | 26.00% | 81.87% | 32.45 |
| phase2 | 2025-06-18 | 24 | g2_no_llm_rule_arbiter | 4.17% | 50.00% | 26.00% | 81.87% | 32.45 |
| phase2 | 2025-06-18 | 24 | g3_llm_postcheck | 4.17% | 66.67% | 30.00% | 81.87% | 39.52 |
| phase2 | 2025-06-18 | 24 | g4_llm_pregate | 4.17% | 70.83% | 34.00% | 81.87% | 41.59 |
| phase2 | 2025-06-18 | 24 | g5_llm_hardfilter | 4.17% | 66.67% | 30.00% | 81.87% | 39.52 |
| phase2 | 2025-06-19 | 24 | g1_no_llm_no_change | 4.17% | 54.17% | 34.55% | 81.87% | 34.98 |
| phase2 | 2025-06-19 | 24 | g2_no_llm_rule_arbiter | 4.17% | 50.00% | 38.18% | 81.87% | 33.67 |
| phase2 | 2025-06-19 | 24 | g3_llm_postcheck | 4.17% | 75.00% | 34.55% | 81.87% | 43.31 |
| phase2 | 2025-06-19 | 24 | g4_llm_pregate | 4.17% | 75.00% | 45.45% | 81.87% | 44.40 |
| phase2 | 2025-06-19 | 24 | g5_llm_hardfilter | 4.17% | 75.00% | 32.73% | 81.87% | 43.13 |
| phase2 | 2025-06-24 | 16 | g1_no_llm_no_change | 0.00% | 50.00% | 36.84% | 0.00% | 23.68 |
| phase2 | 2025-06-24 | 16 | g2_no_llm_rule_arbiter | 0.00% | 50.00% | 63.16% | 0.00% | 26.32 |
| phase2 | 2025-06-24 | 16 | g3_llm_postcheck | 6.25% | 81.25% | 57.89% | 81.87% | 48.98 |
| phase2 | 2025-06-24 | 16 | g4_llm_pregate | 6.25% | 81.25% | 47.37% | 81.87% | 47.92 |
| phase2 | 2025-06-24 | 16 | g5_llm_hardfilter | 0.00% | 81.25% | 57.89% | 0.00% | 38.29 |
| phase2 | 2025-06-28 | 16 | g1_no_llm_no_change | 6.25% | 50.00% | 32.14% | 81.87% | 33.90 |
| phase2 | 2025-06-28 | 16 | g2_no_llm_rule_arbiter | 6.25% | 50.00% | 32.14% | 81.87% | 33.90 |
| phase2 | 2025-06-28 | 16 | g3_llm_postcheck | 6.25% | 75.00% | 35.71% | 81.87% | 44.26 |
| phase2 | 2025-06-28 | 16 | g4_llm_pregate | 6.25% | 75.00% | 42.86% | 81.87% | 44.97 |
| phase2 | 2025-06-28 | 16 | g5_llm_hardfilter | 6.25% | 68.75% | 32.14% | 81.87% | 41.40 |
