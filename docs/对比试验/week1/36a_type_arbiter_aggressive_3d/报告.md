# 36a_type_arbiter_aggressive_3d

目标：比较5组（无LLM/规则仲裁/LLM三种集成方式）对 LA/TA/Explain/Eff/Final 的影响。

说明：评测中 GT 的 `A->B` 会被拆成 `[A,B]`，命中任一端即算 component_correct；但仍要求 **完全相等**（例如 `frontend-0` 不等于 `frontend`）。

## 试验设置
- **phase1**: metadata=../metadata_phase1.csv; gt=../AIOpsChallengeJudge/ground_truth_phase1.jsonl; dates=2025-06-13, 2025-06-14
- **phase2**: metadata=../metadata_phase2.csv; gt=../AIOpsChallengeJudge/ground_truth_phase2.jsonl; dates=2025-06-27
- suite slug: `type_arbiter_aggressive_3d`（对应 outputs/experiments/type_arbiter_aggressive_3d/）

## 候选方案
- 组1：不调用LLM + 不改算法（aggressive dominance）（key=g1_no_llm_no_change）
- 组2：不调用LLM + 规则仲裁（postcheck，aggressive dominance）（key=g2_no_llm_rule_arbiter）
- 组3：LLM类型仲裁（postcheck，aggressive dominance）（key=g3_llm_postcheck）
- 组4：LLM类型仲裁（pregate，aggressive dominance）（key=g4_llm_pregate）
- 组5：LLM类型仲裁（hardfilter，aggressive dominance）（key=g5_llm_hardfilter）

## 结果汇总（全部 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（aggressive dominance） | 64 | 0.00% | 43.75% | 21.15% | 0.00% | 19.62 |
| 组2：不调用LLM + 规则仲裁（postcheck，aggressive dominance） | 64 | 0.00% | 39.06% | 28.85% | 0.00% | 18.51 |
| 组3：LLM类型仲裁（postcheck，aggressive dominance） | 64 | 0.00% | 68.75% | 34.62% | 0.00% | 30.96 |
| 组4：LLM类型仲裁（pregate，aggressive dominance） | 64 | 0.00% | 73.44% | 31.73% | 0.00% | 32.55 |
| 组5：LLM类型仲裁（hardfilter，aggressive dominance） | 64 | 0.00% | 64.06% | 37.50% | 0.00% | 29.38 |

## phase1 结果汇总（该 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（aggressive dominance） | 40 | 0.00% | 45.00% | 18.97% | 0.00% | 19.90 |
| 组2：不调用LLM + 规则仲裁（postcheck，aggressive dominance） | 40 | 0.00% | 40.00% | 27.59% | 0.00% | 18.76 |
| 组3：LLM类型仲裁（postcheck，aggressive dominance） | 40 | 0.00% | 70.00% | 34.48% | 0.00% | 31.45 |
| 组4：LLM类型仲裁（pregate，aggressive dominance） | 40 | 0.00% | 72.50% | 36.21% | 0.00% | 32.62 |
| 组5：LLM类型仲裁（hardfilter，aggressive dominance） | 40 | 0.00% | 62.50% | 39.66% | 0.00% | 28.97 |

## phase2 结果汇总（该 phase 合并；严格按 judge 累计计算）

| 方案 | 样本数N | LA | TA | Explain | Eff | Final |
|---|---:|---:|---:|---:|---:|---:|
| 组1：不调用LLM + 不改算法（aggressive dominance） | 24 | 0.00% | 41.67% | 23.91% | 0.00% | 19.06 |
| 组2：不调用LLM + 规则仲裁（postcheck，aggressive dominance） | 24 | 0.00% | 37.50% | 30.43% | 0.00% | 18.04 |
| 组3：LLM类型仲裁（postcheck，aggressive dominance） | 24 | 0.00% | 66.67% | 34.78% | 0.00% | 30.14 |
| 组4：LLM类型仲裁（pregate，aggressive dominance） | 24 | 0.00% | 75.00% | 26.09% | 0.00% | 32.61 |
| 组5：LLM类型仲裁（hardfilter，aggressive dominance） | 24 | 0.00% | 66.67% | 34.78% | 0.00% | 30.14 |

## LA 丢分点分析（组件命中）

为避免报告过长，本节仅对 **Final 最优** 的方案（组4：LLM类型仲裁（pregate，aggressive dominance），key=g4_llm_pregate）做错因分解。

- 样本数 N=64，原始 LA=0.00%（命中 0/64）
- 命名后缀归一化（仅用于解释，不改变 judge 规则）可带来的理论上限：约 3.12%
- 纯后缀错配计数：GT 为 `*-0` 但预测 base（可选 pod 才能修复）=1；预测为 `*-0` 但 GT 为 base（可通过 strip 修复）=0

| 类别 | 计数 | 解释 |
|---|---:|---|
| HIT | 0 | 预测 component 与 GT parts 任一端完全相等 |
| GT_NODE__PRED_SERVICE | 19 | GT 是 node/TiDB，预测成服务 |
| GT_SERVICE__PRED_NODE | 7 | GT 是服务，预测成 node/TiDB |
| SAME_KIND_BUT_WRONG | 38 | 同类型但选错对象（服务/节点内互相混淆） |

Top 混淆对（GT -> Pred，按出现次数）
| 次数 | GT | Pred |
|---:|---|---|
| 4 | aiops-k8s-05 | cartservice |
| 2 | checkoutservice->currencyservice | emailservice |
| 2 | tidb-tikv-0 | cartservice |
| 2 | tidb-tikv-0 | adservice |
| 1 | adservice-0 | cartservice |
| 1 | aiops-k8s-04 | emailservice |
| 1 | aiops-k8s-07 | cartservice |
| 1 | aiops-k8s-08 | cartservice |
| 1 | adservice-0 | checkoutservice |
| 1 | adservice-0 | emailservice |

## 分 phase 分日期明细

| phase | date | N | 方案key | LA | TA | Explain | Eff | Final |
|---|---|---:|---|---:|---:|---:|---:|---:|
| phase1 | 2025-06-13 | 24 | g1_no_llm_no_change | 0.00% | 33.33% | 14.29% | 0.00% | 14.76 |
| phase1 | 2025-06-13 | 24 | g2_no_llm_rule_arbiter | 0.00% | 29.17% | 17.86% | 0.00% | 13.45 |
| phase1 | 2025-06-13 | 24 | g3_llm_postcheck | 0.00% | 58.33% | 32.14% | 0.00% | 26.55 |
| phase1 | 2025-06-13 | 24 | g4_llm_pregate | 0.00% | 58.33% | 28.57% | 0.00% | 26.19 |
| phase1 | 2025-06-13 | 24 | g5_llm_hardfilter | 0.00% | 54.17% | 28.57% | 0.00% | 24.52 |
| phase1 | 2025-06-14 | 16 | g1_no_llm_no_change | 0.00% | 62.50% | 23.33% | 0.00% | 27.33 |
| phase1 | 2025-06-14 | 16 | g2_no_llm_rule_arbiter | 0.00% | 56.25% | 36.67% | 0.00% | 26.17 |
| phase1 | 2025-06-14 | 16 | g3_llm_postcheck | 0.00% | 87.50% | 36.67% | 0.00% | 38.67 |
| phase1 | 2025-06-14 | 16 | g4_llm_pregate | 0.00% | 93.75% | 43.33% | 0.00% | 41.83 |
| phase1 | 2025-06-14 | 16 | g5_llm_hardfilter | 0.00% | 75.00% | 50.00% | 0.00% | 35.00 |
| phase2 | 2025-06-27 | 24 | g1_no_llm_no_change | 0.00% | 41.67% | 23.91% | 0.00% | 19.06 |
| phase2 | 2025-06-27 | 24 | g2_no_llm_rule_arbiter | 0.00% | 37.50% | 30.43% | 0.00% | 18.04 |
| phase2 | 2025-06-27 | 24 | g3_llm_postcheck | 0.00% | 66.67% | 34.78% | 0.00% | 30.14 |
| phase2 | 2025-06-27 | 24 | g4_llm_pregate | 0.00% | 75.00% | 26.09% | 0.00% | 32.61 |
| phase2 | 2025-06-27 | 24 | g5_llm_hardfilter | 0.00% | 66.67% | 34.78% | 0.00% | 30.14 |
